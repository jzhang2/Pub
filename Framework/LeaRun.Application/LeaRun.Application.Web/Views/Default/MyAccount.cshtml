@{
    ViewBag.Title = "个人中心";
    ViewBag.navIndex = -1;
    Layout = "~/Views/Shared/_LayoutHome.cshtml";
}
@using LeaRun.Application.Entity.ExtendManage
@model LeaRun.Application.Web.Controllers.HomeViewModel
<script src="~/Content/scripts/plugins/uploadify/ajaxfileupload.js"></script>
<script src="~/Content/scripts/plugins/datepicker/WdatePicker.js"></script>
<script src="~/Content/scripts/utils/learun-ui.js"></script>
<script src="~/Content/scripts/utils/learun-form.js"></script>
<link href="~/Content/scripts/plugins/dialog/dialog.css" rel="stylesheet" />
<script src="~/Content/scripts/plugins/dialog/dialog.js"></script>
<script src="~/Content/scripts/plugins/uploadify/bootstrap-filestyle.min.js"></script>
<style>
    .file img {
        border-radius: 50%;
    }
</style>
<div>
    <img src="~/images/baneer1.png" class="img-responsive" />
</div>
@Html.AntiForgeryToken()
<div id="best-deal" class="myaccount">
    <div class="container">
        <div class="row">
            <div class="account-nav col-md-2 col-sm-12 col-xs-12" style="padding: 0; background: white">
                <div class="col-md-12" style="padding: 0;">
                    <img src="~/images/丁图.png" class="img-responsive" style="width: 100%" />
                    <ul>
                        <li class="active"><a href="javascript:;"><img src="~/images/个人资料选择效果.png" />个人资料</a></li>
                        @*<li><a href="javascript:;"><img src="~/images/我的定制选择效果.png" />我的书签</a></li>*@
                    </ul>
                </div>
            </div>
            <div class="col-md-10 col-sm-12 col-xs-12 right-content">
                <div class="col-md-12" style="background: white;">
                    <div class="MyProfile col-md-6 col-sm-12 col-xs-12" style="">
                        <form class="form-horizontal" role="form" id="form1">
                            <div class="form-group">
                                <label for="uploadPreview" class="control-label col-sm-3">头像</label>
                                <div class="col-sm-9">
                                    <div class="file">
                                        <img id="uploadPreview" style="width: 70px; height: 70px;" src="@(!string.IsNullOrEmpty(Model.Customer.HeadIcon) ? Model.Customer.HeadIcon : "/Content/images/logo-headere47d5.png")" /><input type="file" name="uploadFile" id="uploadFile"><input type="hidden" id="HeadIcon" value="@(!string.IsNullOrEmpty(Model.Customer.HeadIcon) ? Model.Customer.HeadIcon : "/Content/images/logo-headere47d5.png")" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="FullName" class="control-label col-sm-3">昵称</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="FullName" placeholder="" value="@Model.Customer.FullName">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="Mobile" class="control-label col-sm-3">手机号</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="Mobile" placeholder="" value="@Model.Customer.Mobile">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="Gender" class="control-label col-sm-3">性别</label>
                                <div class="col-sm-9">
                                    <label class="radio-inline"><input type="radio" name="Gender" value="1" @(Model.Customer.Gender == 1 ? "checked" : "")>男</label>
                                    <label class="radio-inline"><input type="radio" name="Gender" value="0" @(Model.Customer.Gender == 0 ? "checked" : "")>女</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="Birthday" class="control-label col-sm-3">生日</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="Birthday" placeholder="" onfocus="WdatePicker({ maxDate: '%y-%M-%d' })" value="@(Model.Customer.Birthday!=null?Convert.ToDateTime(Model.Customer.Birthday).ToString("yyyy-MM-dd"):"")">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="City" class="control-label col-sm-3">城市</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="City" placeholder="" value="@Model.Customer.City">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="CompanySite" class="control-label col-sm-3">职业</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="CompanySite" placeholder="" value="@Model.Customer.CompanySite">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="CompanyDesc" class="control-label col-sm-3">学历</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="CompanyDesc" placeholder="" value="@Model.Customer.CompanyDesc">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="Hobby" class="control-label col-sm-3">兴趣标签</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="Hobby" placeholder="" value="@Model.Customer.Hobby">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-3 col-sm-9">
                                    <button onclick="AcceptClick();" type="button" class="btn btn-default signinbtn" style="margin-right: 20px;" id="btnlogin">保存</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function btn_download(keyValue) {
        $.download("../../ExtendManage/Contribution/Download", "keyValue=" + keyValue, 'post');

    }
    function AcceptClick() {
        //if (!$('#form1').Validform()) {
        //    return false;
        //}
        var keyValue = '@Model.Customer.CustomerId';
        var postData = $("#form1").GetWebControls(keyValue);
        postData["Gender"] = $('#form1 input[name="Gender"]:checked ').val();
        $.SaveForm({
            url: "../../ExtendManage/Customer/SaveFormFront?keyValue=" + keyValue,
            param: postData,
            loading: "正在保存数据...",
            success: function (data) {
                if (data.type == "1") {
                    $("#HeadIcon_imgs img").attr('src', $("#HeadIcon").val());
                }
            }
        });
    }
    function SaveSuggestion() {
        var postData = $("#form2").GetWebControls();
        if (postData.Title == "") {
            dialogMsg("请输入标题", 2);
            return;
        }
        if (postData.Contents == "") {
            dialogMsg("请输入内容", 2);
            return;
        }
        postData["Gender"] = $('#form1 input[name="Gender"]:checked ').val();
        $.SaveForm({
            url: "../../ExtendManage/Suggestion/SaveFormFront",
            param: postData,
            loading: "正在保存数据...",
            success: function (data) {
            }
        });
    }
    function SaveContri() {
        var postData = {
            Title: $("#ContriTitle").val(),
            Description: $("#Description").val(),
            FileName: $("#FileName").val(),
            FilePath: $("#FilePath").val()
        }
        if (postData.Title == "") {
            dialogMsg("请输入标题", 2);
            return;
        }
        if (postData.FilePath == "") {
            dialogMsg("请上传稿件", 2);
            return;
        }
        $.SaveForm({
            url: "../../ExtendManage/Contribution/SaveFormFront",
            param: postData,
            loading: "正在保存数据...",
            success: function (data) {
                if (data.type == "1") {
                    var entity = data.resultdata;
                    var html = "";
                    html += '<tr>';
                    html += '<td>' + entity.Title + '</td>';
                    html += '<td>' + entity.Description + '</td>';
                    html += '<td><a href="javascript:;" onclick="btn_download(\'' + entity.ContributionId + '\')" style="cursor: pointer;">' + entity.FileName.substring(0, entity.FileName.lastIndexOf('.')) + '</a></td>';
                    html += '<td>' + (entity.ContributionStatus == null ? "" : entity.ContributionStatus) + '</td>';
                    html += '<td>' + entity.CreateDate + '</td>';
                    html += '</tr>';
                    $("#contb").prepend(html);
                }
            }
        });
    }
    function uphead() {
        var f = document.getElementById('uploadFile').files[0];
        var src = window.URL.createObjectURL(f);
        document.getElementById('uploadPreview').src = src;
        //上传应用图标
        $.ajaxFileUpload({
            url: "/ExtendManage/Books/UploadFile",
            secureuri: false,
            fileElementId: 'uploadFile',
            dataType: 'json',
            success: function (data) {
                if (data.type == 1) {
                    $("#HeadIcon").val(data.resultdata);
                }
                dialogMsg(data.message, data.type);
                $('#uploadFile').on('change', uphead);
            }
        });
    }
    function upfile() {
        //上传应用图标
        $.ajaxFileUpload({
            url: "/ExtendManage/Books/UploadDocument",
            secureuri: false,
            fileElementId: 'uploadFile1',
            dataType: 'json',
            success: function (data) {
                if (data.type == 1) {
                    $("#FileName").val(data.resultdata.fileName);
                    $("#FilePath").val(data.resultdata.filePath);
                }
                dialogMsg(data.message, data.type);
                $('#uploadFile1').on('change', upfile);
            }
        });
    }
    $(function () {
        var tabindex = '@(ViewContext.RouteData.Values["id"])';
        $(".account-nav ul li").eq(tabindex).addClass("active").siblings().removeClass("active");
        $(".myaccount .row .right-content").hide().eq(tabindex).show();
        $(".account-nav ul li").click(function () {
            $(this).addClass("active").siblings().removeClass("active");
            $(".myaccount .row .right-content").hide().eq($(this).index()).show();
        });
        $(".sugg-nav ul li").click(function () {
            $(this).addClass("active").siblings().removeClass("active");
            $(".sugg-content").hide().eq($(this).index()).show();
        });
        $(".contri-nav ul li").click(function () {
            $(this).addClass("active").siblings().removeClass("active");
            $(".contri-content").hide().eq($(this).index()).show();
        });
        $(".cus-nav ul li").click(function () {
            $(this).addClass("active").siblings().removeClass("active");
            $(".cus-content").hide().eq($(this).index()).show();
        });
        $("#uploadFile1").filestyle({ icon: false });
        $('#uploadFile').on('change', uphead);
        $('#uploadFile1').on('change', upfile);
    });
</script>